name: playwright-tests
on: 
    push:
        branches:
            - main
            - dev
    workflow_dispatch:

jobs:
    # putting this job into a container -> if you wanted to add the image from the project you need to host it on docker hub or somewhere

    run-tests:
        runs-on: ubuntu-latest
        container:
          image: mcr.microsoft.com/dotnet/sdk:8.0  # geting the base image from microsoft
        steps:
        # all the seteps will work as before except they will run in the container 
            - uses: actions/checkout@v4
            
            - name: setup dotnet environment # this step can now be skipped entirely since we running in a container with dotnet , im just keeping it for myself for later projects
              uses: actions/setup-dotnet@v4
              with:
                dotnet-version: 8.0.x
            - name: install dependencies and build
              run: dotnet build


            - name: check that the browsers have been installed
              run: pwsh bin/Debug/net8.0/playwright.ps1 install
            - name: run tests
              id: run-tests
              run: dotnet test --logger "trx;LogFileName=test_results.trx"
          
              
            - name: upload test report artifact if tests fail
              if: ${{failure() && steps.run-tests.outcome == 'failure'}}
              uses: actions/upload-artifact@v4
              with:
                name: Test-reports-folder
                path: TestReports
           
           
            - name: List test results folder
              if: always()
              run: |
                ls -R TestReports
                find TestReports -type f
